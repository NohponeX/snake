!function(a){function b(a){return decodeURIComponent(a)!==a}function c(){var b={};a.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(a,c,d){b[c]=d});return b}var d={snake:"#9C4150",snakeHead:"#580B17",food:"#FFCC00",score:"#9C4150",border:"#2D2D2D",tail:"rgba(156, 65, 80, 0.75)"},e={left:[-1,0],right:[1,0],up:[0,-1],down:[0,1],opposite:function(a){return a===e.left?e.right:a===e.right?e.left:a===e.up?e.down:a===e.down?e.up:[-1*a[0],-1*a[1]]}},f={direction:e.up,positions:[],move:function(){var a=[this.positions[0][0]+this.direction[0],this.positions[0][1]+this.direction[1]];this.positions.pop(),this.positions.unshift(a)},eat:function(){var a=[this.positions[0][0]+this.direction[0],this.positions[0][1]+this.direction[1]];this.positions.unshift(a)}},g={direction:null,position:null,chase:function(){this.direction=e.up;var a,b=f.positions[0][0]-this.position[0],c=f.positions[0][1]-this.position[1],d=null;Math.abs(b)>=Math.abs(c)?(a=b,0===b?this.direction=e.opposite(f.direction):this.direction=b>=0?e.right:e.left,d=c>=0?e.down:e.up):(a=c,0===c?this.direction=e.opposite(f.direction):this.direction=c>=0?e.down:e.up,d=b>=0?e.right:e.left),this.willCollide(this.direction)&&(this.direction=null,console.log("avoiding collition with snake`s body"),0===a||this.willCollide(d)||(this.direction=d,console.log("use alternative direction"))),this.direction&&this.outOfBorders(this.direction)&&(console.log("outOfBorders"),this.direction=null,this.outOfBorders(d)||(this.direction=d))},move:function(){this.direction&&(0===Math.floor(5*Math.random()),this.position[0]+=this.direction[0],this.position[1]+=this.direction[1])},willCollide:function(a){var b=[this.position[0]+a[0],this.position[1]+a[1]];for(i=1;i<f.positions.length;++i)if(b[0]===f.positions[i][0]&&b[1]===f.positions[i][1])return!0;return!1},outOfBorders:function(a){var b=[this.position[0]+a[0],this.position[1]+a[1]];return b[0]<1||b[1]<1||b[0]>=h.width||b[1]>=h.height?!0:!1}},h={interval:null,width:0,height:0,boxWidth:15,boxHeight:15,foods:g,score:0,gameOver:!0,clearBorder:!0,sounds:!0,paused:!1,level:0,canvas:null,canvasWidth:0,canvasHeight:0,context:null,levelSpeed:[200,199,197,196,194,191,189,186,183,181,178,175,171,168,165,161,158,154,150,147,143,139,135,131,127,123,119,114,110,106,101,97,92,88,83,79,74,69,64,59,55,50,45,40,35],currentSpeed:0,snakeHeadImage:null,foodImage:null,setup:function(a,b){a&&(this.snakeHeadImage=a),b&&(this.foodImage=b),this.width=Math.ceil(this.canvasWidth/this.boxWidth)-1,this.height=Math.ceil((this.canvasHeight-30)/this.boxHeight)-1,this.gameOver=!1,this.clearBorder=!0,f.direction=e.up,f.positions=[[Math.floor(Math.random()*(this.width-1))+1,Math.floor(Math.random()*(this.height-this.height/2)+this.height/2)]],f.eat(),f.eat(),f.eat(),h.score=0,h.level=0,h.currentSpeed=h.levelSpeed[h.level],h.interval=setInterval(h.tick,h.currentSpeed),h.drawScore()},initialize:function(){h.setup(),this.gameOver=!0,clearInterval(h.interval),h.draw(),h.drawGameover()},restart:function(){clearInterval(h.interval),h.setup()},pause:function(){h.paused=!0,h.drawPaused()},resume:function(){h.paused=!1,h.interval||(h.interval=setInterval(h.tick,h.currentSpeed)),h.drawScore()},levelUp:function(){h.level+1>=h.levelSpeed.length||(h.interval&&(clearInterval(h.interval),h.interval=null),h.currentSpeed=h.levelSpeed[++h.level],h.interval=setInterval(h.tick,h.currentSpeed))},tick:function(){return h.gameOver?void 0:h.paused?(h.draw(),clearInterval(h.interval),void(h.interval=null)):(null===h.foods.position?h.createFood():h.checkEatFood()&&(f.eat(),h.createFood(),h.score++,h.drawScore(),j.consume(),h.score>3*h.level&&h.levelUp()),f.move(),h.foods.position&&h.level%2&&(h.foods.chase(),h.foods.move()),h.draw(),(h.checkWallCollusion()||h.checkSnakeCollusion())&&(h.gameOver=!0),h.gameOver?(j.gameOver(),clearInterval(h.interval),h.drawScore(),void h.drawGameover()):void 0)},draw:function(){var a,b;if(h.clearBorder){for(h.context.clearRect(0,0,h.canvasWidth,this.boxHeight*h.height),h.context.fillStyle=d.border,a=0;a<=h.width;a++)for(b=0;b<=h.height;b++)b&&a&&b!==h.height&&a!==h.width||h.context.fillRect(this.boxWidth*a,this.boxHeight*b,this.boxWidth,this.boxHeight);h.clearBorder=!1}else h.context.clearRect(this.boxWidth,this.boxHeight,(h.width-1)*this.boxWidth,(h.height-1)*this.boxHeight);for(h.context.fillStyle=d.snakeHead,h.context.drawImage(this.snakeHeadImage,this.boxWidth*f.positions[0][0]+.5,this.boxHeight*f.positions[0][1]+.5,this.boxWidth-1,this.boxHeight-1),h.context.fillStyle=d.snake,a=1;a<f.positions.length-1;++a)h.context.fillRect(this.boxWidth*f.positions[a][0]+.5,this.boxHeight*f.positions[a][1]+.5,this.boxWidth-1,this.boxHeight-1);a=f.positions.length-1,h.context.fillStyle=d.tail,h.context.fillRect(this.boxWidth*f.positions[a][0]+.5,this.boxHeight*f.positions[a][1]+.5,this.boxWidth-1,this.boxHeight-1),h.foods.position&&(h.context.fillStyle=d.food,h.context.drawImage(this.foodImage,this.boxWidth*h.foods.position[0],this.boxWidth*h.foods.position[1],this.boxWidth,this.boxWidth))},drawScore:function(){h.context.clearRect(0,(h.height+2)*this.boxHeight,h.canvasWidth,h.canvasHeight-(h.height+2)*this.boxHeight),h.context.fillStyle=d.score,h.context.fillText("Score: "+this.score+" Level: "+this.level,this.boxWidth,(h.height+3)*this.boxHeight)},drawGameover:function(){h.context.fillStyle=d.score,h.context.fillText("Game over press Enter to play",this.boxWidth+175,(h.height+3)*this.boxHeight)},drawPaused:function(){h.context.fillStyle=d.score,h.context.fillText("Game paused press p to play",this.boxWidth+175,(h.height+3)*this.boxHeight)},checkSnakeCollusion:function(){for(var a=1;a<f.positions.length;++a)if(f.positions[a][0]===f.positions[0][0]&&f.positions[a][1]===f.positions[0][1])return!0;return!1},checkWallCollusion:function(){var a=f.positions[0][0],b=f.positions[0][1];return!a||!b||a>=h.width||b>=h.height?!0:!1},checkEatFood:function(){return f.positions[0][0]===h.foods.position[0]&&f.positions[0][1]===h.foods.position[1]},createFood:function(){var a=0,b=0,c=!1;do if(c=!1,a=Math.floor(Math.random()*h.height),b=Math.floor(Math.random()*h.width),!a||!b||a>=h.width||b>=h.height)c=!0;else for(var d=0;d<f.positions.length;d++)if(a===f.positions[d][0]&&b===f.positions[d][1]){c=!0;break}while(c);h.foods.position=[a,b]}};a.snake={initialize:function(d){var e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEVYCxel8h7eAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==",f="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEX/zAB+rZF1AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==",g=c();g.head&&(e=b(g.head)?decodeURIComponent(g.head):g.head),g.food&&(f=decodeURIComponent(g.food));var i=new Image;i.src=e;var j=new Image;j.src=f,h.canvas=a.document.getElementById(d),h.context=h.canvas.getContext("2d"),h.context.font="14px monospace",h.canvasWidth=h.canvas.offsetWidth,h.canvasHeight=h.canvas.offsetHeight,h.setup(i,j),h.pause()}},document.onkeydown=function(a){switch(a.keyCode){case 37:case 65:f.direction===e.left?h.tick():e.left!==e.opposite(f.direction)&&(f.direction=e.left),a.preventDefault();break;case 38:case 87:f.direction===e.up?h.tick():e.up!==e.opposite(f.direction)&&(f.direction=e.up),a.preventDefault();break;case 39:case 68:f.direction===e.right?h.tick():e.right!==e.opposite(f.direction)&&(f.direction=e.right),a.preventDefault();break;case 40:case 83:f.direction===e.down?h.tick():e.down!==e.opposite(f.direction)&&(f.direction=e.down),a.preventDefault();break;case 13:h.gameOver&&(h.restart(),a.preventDefault());break;case 80:h.gameOver?(h.restart(),a.preventDefault()):h.paused?h.resume():h.pause(),a.preventDefault()}};var j={sounds:{},consume:function(){this.sounds.consume.play()},gameOver:function(){this.sounds.gameOver.play()},initialize:function(){this.sounds.consume=new Audio,this.sounds.consume.setAttribute("src","sounds/pick_up.ogg"),this.sounds.consume.repeat=!1,this.sounds.consume.loop=!1,this.sounds.consume.volume=.15,this.sounds.gameOver=new Audio,this.sounds.gameOver.setAttribute("src","sounds/game_over.ogg"),this.sounds.gameOver.repeat=!1,this.sounds.gameOver.loop=!1,this.sounds.gameOver.volume=.15}};j.initialize()}(window);